<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bodegón App - Gestión de Productos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* [Tus estilos actuales] */
    /* ... (manteniendo todos tus estilos actuales) ... */
    
    /* Nuevos estilos para navegación */
    .app-sidebar {
      width: 250px;
      background-color: #2b2b2b;
      color: white;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      padding-top: 60px;
      overflow-y: auto;
      z-index: 900;
    }
    .app-sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .app-sidebar li {
      padding: 0;
    }
    .app-sidebar a {
      color: #ddd;
      text-decoration: none;
      display: flex;
      align-items: center;
      padding: 12px 20px;
      transition: all 0.3s;
      gap: 10px;
    }
    .app-sidebar a:hover, .app-sidebar a.active {
      background-color: #3a3a3a;
      color: #8bc34a;
    }
    .sidebar-module {
      font-weight: bold;
      color: #8bc34a;
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 0.9rem;
    }
    .sidebar-submodule {
      padding-left: 30px;
      font-size: 0.9rem;
    }
    .main-content-with-sidebar {
      margin-left: 250px;
      width: calc(100% - 250px);
    }
    .sidebar-toggle {
      display: none;
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1000;
      background: #8bc34a;
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
    }
    
    @media (max-width: 992px) {
      .app-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      .app-sidebar.open {
        transform: translateX(0);
      }
      .main-content-with-sidebar {
        margin-left: 0;
        width: 100%;
      }
      .sidebar-toggle {
        display: block;
      }
    }
  </style>
</head>
<body>
  <!-- Botón para toggle sidebar en móviles -->
  <button class="sidebar-toggle" id="sidebarToggle">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Sidebar de navegación -->
  <div class="app-sidebar" id="appSidebar">
    <div class="logo" style="padding: 20px; border-bottom: 1px solid #444;">
      <i class="fas fa-store logo-icon"></i>
      <h1>Bodegón App</h1>
    </div>
    
    <ul>
      <li class="sidebar-module">MÓDULOS PRINCIPALES</li>
      <li><a href="productos.html" class="active"><i class="fas fa-box"></i> Productos</a></li>
      <li><a href="../01_gestion_principal/inventario.html"><i class="fas fa-warehouse"></i> Inventario</a></li>
      <li><a href="../01_gestion_principal/facturacion.html"><i class="fas fa-file-invoice-dollar"></i> Facturación</a></li>
      <li><a href="../01_gestion_principal/caja.html"><i class="fas fa-cash-register"></i> Caja</a></li>
      
      <li class="sidebar-module">GESTIÓN DE ENTIDADES</li>
      <li><a href="../02_gestion_entidades/clientes.html"><i class="fas fa-users"></i> Clientes</a></li>
      <li><a href="../02_gestion_entidades/proveedores.html"><i class="fas fa-truck-loading"></i> Proveedores</a></li>
      
      <li class="sidebar-module">OPERACIONES</li>
      <li><a href="../03_operaciones/compras.html"><i class="fas fa-shopping-cart"></i> Compras</a></li>
      <li><a href="../03_operaciones/delivery.html"><i class="fas fa-motorcycle"></i> Delivery</a></li>
    </ul>
  </div>

  <!-- Cabecera -->
  <header style="margin-left: 250px; width: calc(100% - 250px);" id="mainHeader">
    <div class="logo">
      <i class="fas fa-box logo-icon"></i>
      <h1>Bodegón App - Productos</h1>
    </div>
    <div class="user-actions">
      <button><i class="fas fa-user"></i> Usuario</button>
      <button onclick="eventBus.notify('user:logout')"><i class="fas fa-sign-out-alt"></i> Salir</button>
    </div>
  </header>

  <!-- Contenido principal -->
  <div class="main-content-with-sidebar" id="mainContent">
    <!-- [Todo el contenido actual de productos] -->
    <!-- ... (todo tu contenido actual de productos.html) ... -->
  </div>

  <!-- Modal para agregar/editar producto -->
  <div class="modal" id="productModal">
    <!-- [Contenido actual del modal] -->
  </div>

  <script>
    // ==============================================
    // SISTEMA DE EVENTOS GLOBAL (Event Bus)
    // ==============================================
    const eventBus = {
      listeners: {},
      
      // Registrar un listener para un evento
      on: function(eventName, callback) {
        if (!this.listeners[eventName]) {
          this.listeners[eventName] = [];
        }
        this.listeners[eventName].push(callback);
        
        // Para debugging
        console.log(`Evento registrado: ${eventName}`);
      },
      
      // Eliminar un listener
      off: function(eventName, callback) {
        if (this.listeners[eventName]) {
          this.listeners[eventName] = this.listeners[eventName].filter(
            listener => listener !== callback
          );
        }
      },
      
      // Disparar un evento
      notify: function(eventName, data) {
        if (this.listeners[eventName]) {
          console.log(`Evento disparado: ${eventName}`, data);
          this.listeners[eventName].forEach(callback => {
            try {
              callback(data);
            } catch (error) {
              console.error(`Error en listener para ${eventName}:`, error);
            }
          });
        }
      }
    };

    // ==============================================
    // MÓDULO DE PRODUCTOS (comunicación con otros módulos)
    // ==============================================
    const ProductManager = {
      init: function() {
        this.setupEventListeners();
        this.loadProducts();
        
        // Escuchar eventos de otros módulos
        eventBus.on('inventory:updated', this.handleInventoryUpdate.bind(this));
        eventBus.on('purchase:created', this.handleNewPurchase.bind(this));
        eventBus.on('exchangeRate:updated', this.handleExchangeRateUpdate.bind(this));
      },
      
      setupEventListeners: function() {
        // [Tus event listeners actuales]
      },
      
      loadProducts: function() {
        // Cargar productos desde localStorage o API
        console.log("Cargando productos...");
        // Tu lógica actual de carga de productos
      },
      
      // Manejar actualización de inventario
      handleInventoryUpdate: function(data) {
        console.log("Inventario actualizado recibido:", data);
        // Actualizar stock de productos afectados
        this.updateProductStock(data.productId, data.newStock);
        
        // Notificar a la interfaz para actualizar
        this.refreshProductDisplay();
      },
      
      // Manejar nueva compra de productos
      handleNewPurchase: function(data) {
        console.log("Nueva compra recibida:", data);
        // Aquí podrías agregar los nuevos productos al inventario
        // o actualizar existentes según la data recibida
      },
      
      // Manejar actualización de tasa de cambio
      handleExchangeRateUpdate: function(newRate) {
        console.log("Tasa de cambio actualizada:", newRate);
        // Recalcular precios en dólares
        this.recalculateDollarPrices(newRate);
      },
      
      updateProductStock: function(productId, newStock) {
        // Lógica para actualizar el stock de un producto
        console.log(`Actualizando stock del producto ${productId} a ${newStock}`);
      },
      
      refreshProductDisplay: function() {
        // Lógica para refrescar la visualización de productos
        console.log("Refrescando visualización de productos");
      },
      
      recalculateDollarPrices: function(exchangeRate) {
        // Lógica para recalcular precios en dólares
        console.log(`Recalculando precios con tasa ${exchangeRate}`);
      },
      
      // Notificar a otros módulos sobre cambios en productos
      notifyProductCreated: function(productData) {
        eventBus.notify('product:created', productData);
      },
      
      notifyProductUpdated: function(productData) {
        eventBus.notify('product:updated', productData);
      },
      
      notifyProductDeleted: function(productId) {
        eventBus.notify('product:deleted', productId);
      },
      
      notifyLowStock: function(productData) {
        eventBus.notify('product:lowStock', productData);
      }
    };

    // ==============================================
    // EJEMPLOS DE OTROS MÓDULOS (para mostrar cómo se comunicarían)
    // ==============================================
    
    // Módulo de Inventario (inventario.html)
    const InventoryManager = {
      init: function() {
        // Escuchar eventos de productos
        eventBus.on('product:created', this.addToInventory.bind(this));
        eventBus.on('product:updated', this.updateInventory.bind(this));
        eventBus.on('product:deleted', this.removeFromInventory.bind(this));
      },
      
      addToInventory: function(productData) {
        console.log("Agregando producto al inventario:", productData);
        // Lógica para agregar producto al inventario
      },
      
      updateInventory: function(productData) {
        console.log("Actualizando producto en inventario:", productData);
        // Lógica para actualizar producto en inventario
      },
      
      removeFromInventory: function(productId) {
        console.log("Eliminando producto del inventario:", productId);
        // Lógica para eliminar producto del inventario
      },
      
      // Ejemplo: notificar a productos sobre cambio de stock
      notifyStockUpdate: function(productId, newStock) {
        eventBus.notify('inventory:updated', {
          productId: productId,
          newStock: newStock
        });
      }
    };
    
    // Módulo de Facturación (facturacion.html)
    const BillingManager = {
      init: function() {
        // Escuchar eventos de productos
        eventBus.on('product:updated', this.updateProductCatalog.bind(this));
        eventBus.on('product:deleted', this.removeFromCatalog.bind(this));
      },
      
      updateProductCatalog: function(productData) {
        console.log("Actualizando catálogo de facturación:", productData);
        // Lógica para actualizar productos en facturación
      },
      
      removeFromCatalog: function(productId) {
        console.log("Eliminando producto de facturación:", productId);
        // Lógica para eliminar producto de facturación
      }
    };

    // ==============================================
    // INICIALIZACIÓN
    // ==============================================
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar el manager de productos
      ProductManager.init();
      
      // Inicializar otros managers (cada módulo inicializa los suyos)
      // InventoryManager.init();
      // BillingManager.init();
      
      // Ajustar la interfaz para el sidebar
      adjustLayoutForSidebar();
      
      // Setup para el toggle del sidebar en móviles
      document.getElementById('sidebarToggle').addEventListener('click', function() {
        document.getElementById('appSidebar').classList.toggle('open');
      });
    });

    // Ajustar el layout para el sidebar
    function adjustLayoutForSidebar() {
      const sidebar = document.getElementById('appSidebar');
      const header = document.getElementById('mainHeader');
      const content = document.getElementById('mainContent');
      
      if (window.innerWidth <= 992) {
        sidebar.style.marginLeft = "0";
        header.style.marginLeft = "0";
        header.style.width = "100%";
        content.style.marginLeft = "0";
        content.style.width = "100%";
      }
    }

    // [El resto de tu código JavaScript actual]
    // ... (tus funciones openModal, closeModal, etc.) ...
  </script>
</body>
</html>
